<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="liveStreaming.mapper.VideoRecordMapper">

    <!-- MyPage View -->
    <select id="videoRecord" resultType="liveStreaming.dto.VideoRecordDto">
        select * from ssf_schema.video_upload where u_id=#{u_id} and v_state = 1;
    </select>

    <!-- MainVideo View(랜덤으로 16개 영상 추출) -->
    <select id="mainVideo" resultType="liveStreaming.dto.VideoRecordDto">
        select * from ssf_schema.video_upload where v_state=1 group by v_code ORDER BY RANDOM() limit 16;
    </select>

    <!-- All Video Search 전체에서 영상 조회 -->
    <select id="videoSearch" resultType="liveStreaming.dto.VideoRecordDto">
        select * from ssf_schema.video_upload where v_state=1 and v_name LIKE CONCAT('%',#{v_name},'%');
    </select>

    <!-- List Delete -->
    <update id="videoDelete" parameterType="liveStreaming.dto.VideoRecordDto">
        update ssf_schema.video_upload 
            set v_state = 0 
          where u_id = #{u_id} and v_code = #{v_code};
    </update>

    <!-- Video Upload-->
	<insert id="videoUpload" parameterType="liveStreaming.dto.VideoRecordDto">
        <selectKey resultType="String" keyProperty="v_code" order="BEFORE">
            select (select max(CAST(substring(v_code,4) as integer)) from ssf_schema.video_upload)+1; 
        </selectKey> 
		insert 
		  into ssf_schema.video_upload 
		       (v_code, v_name, v_img, c_code, u_id, v_link, v_descript)
        values
               (concat ('avi', #{v_code}), #{v_name}, #{v_img}, #{c_code}, #{u_id}, #{v_link}, #{v_descript}) 
	</insert>

    <!-- MainPage Top4 Video View -->
    <select id="videoTop5" resultType="liveStreaming.dto.VideoRecordDto">
        select * from ssf_schema.video_upload where v_state=1 ORDER BY v_views DESC LIMIT 4;
    </select>

    <select id="videoViews" resultType="liveStreaming.dto.VideoRecordDto">
        select v_name, v_views from ssf_schema.video_upload 
                where u_id = #{u_id}
                order by v_views DESC 
                LIMIT 10;
    </select>

    <select id="thisVideo" resultType="liveStreaming.dto.VideoRecordDto">
        select * from ssf_schema.video_upload 
            where v_code = #{v_code};
    </select>




</mapper>